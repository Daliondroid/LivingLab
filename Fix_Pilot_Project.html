<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MuDu - Smart Environment Solution</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary-green': '#62a64a',
            'primary-orange': '#ec7c0c',
            'light-green': '#d7ebcd',
            'cream': '#faf9e6',
            'dark-green': '#28361c',
            'text-gray': '#445a3b',
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'bounce-slow': 'bounce 2s infinite',
            'wiggle': 'wiggle 1s ease-in-out infinite',
            'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate',
            'rotate-slow': 'rotate-slow 8s linear infinite',
            'slide-up': 'slide-up 0.8s ease-out',
            'fade-in': 'fade-in 1s ease-out',
            'scale-bounce': 'scale-bounce 0.5s ease-out',
            'loading-dots': 'loading-dots 1.5s ease-in-out infinite',
            'progress-fill': 'progress-fill 3s ease-in-out',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-20px)' },
            },
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' },
            },
            'pulse-glow': {
              '0%': { boxShadow: '0 0 20px rgba(236, 124, 12, 0.4)' },
              '100%': { boxShadow: '0 0 40px rgba(236, 124, 12, 0.8)' },
            },
            'rotate-slow': {
              '0%': { transform: 'rotate(0deg)' },
              '100%': { transform: 'rotate(360deg)' },
            },
            'slide-up': {
              '0%': { transform: 'translateY(50px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            'fade-in': {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            'scale-bounce': {
              '0%': { transform: 'scale(0.8)' },
              '50%': { transform: 'scale(1.1)' },
              '100%': { transform: 'scale(1)' },
            },
            'loading-dots': {
              '0%, 20%': { opacity: '0' },
              '50%': { opacity: '1' },
              '100%': { opacity: '0' },
            },
            'progress-fill': {
              '0%': { width: '0%' },
              '33%': { width: '30%' },
              '66%': { width: '70%' },
              '100%': { width: '100%' },
            },
          }
        }
      }
    }
  </script>
  
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    
    .food-waste-particle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #ff6b35;
      border-radius: 50%;
      animation: fall 3s linear infinite;
    }
    
    @keyframes fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ec7c0c;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Enhanced Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(40, 54, 28, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(10px);
    }

    .loading-content {
      text-align: center;
      color: white;
      max-width: 400px;
      padding: 2rem;
    }

    .loading-progress {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #62a64a, #ec7c0c);
      border-radius: 4px;
      animation: progress-fill 3s ease-in-out;
    }

    .loading-dots span {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ec7c0c;
      margin: 0 2px;
      animation: loading-dots 1.5s ease-in-out infinite;
    }

    .loading-dots span:nth-child(1) { animation-delay: 0s; }
    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

    .loading-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      animation: float 2s ease-in-out infinite;
    }

  </style>
</head>
<body class="bg-gradient-to-b from-light-green to-cream min-h-screen">
  <!-- Enhanced Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-content">
      <div class="loading-icon">
        <i class="fas fa-leaf text-primary-green"></i>
      </div>
      <h3 class="text-2xl font-bold mb-4">Mengirimkan Pendaftaran</h3>
      <p id="loadingText" class="text-gray-300 mb-4">Memproses data pendaftaran Anda...</p>
      
      <div class="loading-progress">
        <div class="progress-bar"></div>
      </div>
      
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
      
      <div id="loadingSteps" class="mt-6 text-left text-sm text-gray-400">
        <div id="step1" class="mb-2">
          <i class="fas fa-circle-notch fa-spin mr-2"></i>
          Validasi data pendaftaran...
        </div>
        <div id="step2" class="mb-2 opacity-50">
          <i class="fas fa-circle mr-2"></i>
          Upload foto ke Google Drive...
        </div>
        <div id="step3" class="mb-2 opacity-50">
          <i class="fas fa-circle mr-2"></i>
          Simpan data ke database...
        </div>
        <div id="step4" class="mb-2 opacity-50">
          <i class="fas fa-circle mr-2"></i>
          Kirim email konfirmasi...
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Food Waste Particles -->
  <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
    <div class="food-waste-particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="food-waste-particle" style="left: 25%; animation-delay: 1s;"></div>
    <div class="food-waste-particle" style="left: 40%; animation-delay: 2s;"></div>
    <div class="food-waste-particle" style="left: 60%; animation-delay: 0.5s;"></div>
    <div class="food-waste-particle" style="left: 80%; animation-delay: 1.5s;"></div>
    <div class="food-waste-particle" style="left: 90%; animation-delay: 2.5s;"></div>
  </div>

  <!-- Navigation -->
  <nav class="fixed top-0 w-full bg-white/95 backdrop-blur-lg border-b-2 border-primary-orange/20 z-50">
    <div class="container mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <!-- Logo -->
        <div class="logo-wrapper">
          <img src="MuDu logo.png" alt="MuDu Logo" class="h-8 sm:h-10" />
        </div>

        <!-- Hamburger Button (mobile only) -->
        <button id="menu-toggle" class="sm:hidden text-[#E98728] text-2xl focus:outline-none">
          <i class="fas fa-bars"></i>
        </button>

        <!-- Desktop Menu -->
        <div class="hidden sm:flex items-center space-x-8">
          <a href="index.html" class="text-text-gray font-semibold hover:text-[#E98728] transition duration-300 hover:scale-110">Home</a>
          <a href="education.html" class="text-text-gray font-semibold hover:text-[#E98728] transition duration-300 hover:scale-110">Education</a>
          <a href="wastemap.html" class="text-text-gray font-semibold hover:text-[#E98728] transition duration-300 hover:scale-110">Waste Map</a>
          <a href="challenge.html" class="font-bold underline underline-offset-4 text-[#E98728]">Challenge</a>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden sm:hidden flex flex-col items-center space-y-3 pt-3">
        <a href="index.html" class="font-bold underline underline-offset-4 text-[#E98728] hover:text-[#E98728] transition-all duration-300 hover:scale-110 whitespace-nowrap">Home</a>
        <a href="education.html" class="text-text-gray font-semibold hover:text-[#E98728] transition-all duration-300 hover:scale-110 whitespace-nowrap">Education</a>
        <a href="wastemap.html" class="text-text-gray font-semibold hover:text-[#E98728] transition-all duration-300 hover:scale-110 whitespace-nowrap">Waste Map</a>
        <a href="challenge.html" class="text-text-gray font-semibold hover:text-[#E98728] transition-all duration-300 hover:scale-110 whitespace-nowrap">Challenge</a>
      </div>

    </div>
  </nav>

  <!-- Form Multi-Halaman MuDu Pilot Project -->
  <section class="pt-32 pb-20 bg-gradient-to-b from-light-green to-cream">
    <div class="container mx-auto px-4">
      <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-8">
        <h2 class="text-3xl font-bold text-dark-green mb-6 text-center">üìã Pendaftaran Challenge MuDu Pilot Project</h2>

        <form id="pilotForm" class="space-y-6" enctype="multipart/form-data" method="post">
          <!-- Step 1 -->
          <div class="form-step" id="step-1">

            <div>
              <label for="name" class="block text-sm font-semibold text-text-gray mb-2">Nama Lengkap</label>
              <input type="text" id="name" name="name" required class="w-full border border-gray-300 rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#E98728] transition" placeholder="Masukkan Nama Lengkap Anda">
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
              <div>
                <label for="city" class="block text-sm font-semibold text-text-gray mb-2">Kota</label>
                <select id="city" name="city" required class="w-full border border-gray-300 rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#E98728] transition">
                  <option value="">-- Pilih Kota --</option>
                  <option value="Jakarta Pusat">Jakarta Pusat</option>
                  <option value="Jakarta Utara">Jakarta Utara</option>
                  <option value="Jakarta Barat">Jakarta Barat</option>
                  <option value="Jakarta Selatan">Jakarta Selatan</option>
                  <option value="Jakarta Timur">Jakarta Timur</option>
                  <option value="Kepulauan Seribu">Kepulauan Seribu</option>
                </select>
              </div>
              <div>
                <label for="district" class="block text-sm font-semibold text-text-gray mb-2">Kecamatan</label>
                <select id="district" name="district" required class="w-full border border-gray-300 rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#E98728] transition">
                  <option value="">-- Pilih Kecamatan --</option>
                </select>
              </div>
              <div>
                <label for="subdistrict" class="block text-sm font-semibold text-text-gray mb-2">Kelurahan</label>
                <select id="subdistrict" name="subdistrict" required class="w-full border border-gray-300 rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#E98728] transition">
                  <option value="">-- Pilih Kelurahan --</option>
                </select>
              </div>
              <div>
                <label for="age" class="block text-sm font-semibold text-text-gray mb-2">Umur</label>
                <input type="number" id="age" name="age" required min="15" max="100" class="w-full border border-gray-300 rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#E98728] transition" placeholder="Masukan Umur Anda">
              </div>
            </div>

            <div class="mt-4">
              <label for="email" class="block text-sm font-semibold text-text-gray mb-2">Email</label>
              <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#E98728] transition" placeholder="email@example.com">
            </div>

            <div class="pt-6 flex justify-between" >
              <button type="button" onclick="window.history.back();" class="text-[#E98728] font-semibold hover:underline">Kembali</button>
              <button type="button" onclick="nextStep(2)" class="bg-primary-orange hover:bg-orange-600 text-white font-bold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105">Lanjut</button>
            </div>
          </div>

          <!-- Step 2 -->
          <div class="form-step hidden" id="step-2">
            <div class="bg-gradient-to-r from-light-green to-cream p-6 rounded-lg mb-6">
              <h3 class="text-lg font-bold text-dark-green mb-3">üå± Mekanisme Challenge MuDu</h3>
              <p class="text-text-gray mb-4">
                Ikuti tantangan memilah dan/atau mengolah sampah sisa makanan dengan membuat kompos dalam pot (edukasi ada di website MuDu), sampah sisa makanan dikumpul dalam satu tempat dalam kurun waktu 3 hari berturut-turut. 
                <br><br>
                <strong>üìÖ Timeline:</strong><br>
                ‚Ä¢ Pendaftaran: 9-10 Juli<br>
                ‚Ä¢ Pengumpulan hasil: 11-12 Juli<br>
                ‚Ä¢ Upload foto dan data lengkap
                <br><br>
                Peserta dinilai berdasarkan foto yang dikirimkan dan akan mendapatkan badge dan ala-ala spotify wrap yang bisa dibagikan di instagram stories, jangan lupa tag <strong>@mudumulaidulu</strong> yah!
              </p>
            </div>

            <div class="mb-6">
              <label class="inline-flex items-start">
                <input type="checkbox" id="mechanism_agree" name="mechanism_agree" required class="form-checkbox text-primary-orange mt-1 mr-3">
                <span class="text-sm text-text-gray">Saya memahami dan menyetujui mekanisme challenge ini</span>
              </label>
            </div>

            <div class="flex justify-between">
              <button type="button" onclick="prevStep(1)" class="text-[#E98728] font-semibold hover:underline">Kembali</button>
              <button type="button" onclick="nextStep(3)" class="bg-primary-orange hover:bg-[#E98728] text-white font-bold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105">Lanjut</button>
            </div>
          </div>

          <!-- Step 3 -->
          <div class="form-step hidden" id="step-3">
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
              <div class="flex">
                <div class="flex-shrink-0">
                  <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                </div>
                <div class="ml-3">
                  <p class="text-sm text-yellow-700">
                    <strong>Penting:</strong> Upload foto kantong plastik kosong sebagai tanda Anda memulai challenge. Foto ini menandakan komitmen Anda untuk mengikuti program MuDu.
                  </p>
                </div>
              </div>
            </div>

            <div class="mb-6">
              <label for="photo" class="block text-sm font-semibold text-text-gray mb-2">üì∏ Unggah Foto Kantong Plastik Kosong</label>
              <input type="file" id="photo" name="photo" accept="image/*" required class="w-full border border-gray-300 rounded-lg px-4 py-3">
              <p class="text-xs text-gray-500 mt-1">Format: JPG, PNG, atau GIF. Maksimal 5MB.</p>
            </div>

            <div class="space-y-4 mb-6">
              <label class="inline-flex items-start">
                <input type="checkbox" id="photo_agree" name="photo_agree" required class="form-checkbox text-primary-orange mt-1 mr-3">
                <span class="text-sm text-text-gray">Foto yang dilampirkan adalah benar dan menandakan saya mengikuti dan mengawali challenge</span>
              </label>

              <label class="inline-flex items-start">
                <input type="checkbox" id="policy_agree" name="policy_agree" required class="form-checkbox text-primary-orange mt-1 mr-3">
                <span class="text-sm text-text-gray">Saya setuju dengan kebijakan MuDu dan memberikan izin untuk menggunakan data saya untuk keperluan program ini</span>
              </label>
            </div>

            <div class="flex justify-between items-center">
              <button type="button" onclick="prevStep(2)" class="text-[#E98728] font-semibold hover:underline">Kembali</button>
              <button id="submitBtn" type="button" onclick="submitForm()" class="bg-primary-orange hover:bg-orange-600 text-white font-bold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105 flex items-center">
                <span id="submitText">Kirim Pendaftaran</span>
                <div id="submitSpinner" class="loading-spinner ml-2 hidden"></div>
              </button>
            </div>
          </div>
        </form>

        <!-- Success Message -->
        <div id="successMessage" class="hidden mt-6 text-center">
          <div class="bg-green-50 border border-green-200 rounded-lg p-6">
            <div class="flex items-center justify-center mb-4">
              <div class="bg-green-100 rounded-full p-2">
                <i class="fas fa-check text-green-600 text-2xl"></i>
              </div>
            </div>
            <h3 class="text-lg font-bold text-green-800 mb-2">üéâ Pendaftaran Berhasil!</h3>
            <p class="text-green-700 mb-4">Terima kasih telah bergabung dengan MuDu Challenge!</p>
            
            <div id="emailStatus" class="mb-4">
              <div id="emailSent" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3">
                <div class="flex items-center justify-center">
                  <i class="fas fa-envelope text-blue-600 mr-2"></i>
                  <span class="text-blue-700 text-sm">üìß Email konfirmasi telah dikirim!</span>
                </div>
              </div>
              <div id="emailFailed" class="hidden bg-orange-50 border border-orange-200 rounded-lg p-3">
                <div class="flex items-center justify-center">
                  <i class="fas fa-exclamation-triangle text-orange-600 mr-2"></i>
                  <span class="text-orange-700 text-sm">‚ö†Ô∏è Email konfirmasi gagal dikirim, namun pendaftaran tetap berhasil.</span>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-lg p-4 text-left">
              <h4 class="font-semibold text-green-800 mb-2">Langkah Selanjutnya:</h4>
              <ul class="text-sm text-green-700 space-y-1">
                <li>‚úÖ Cek email untuk konfirmasi pendaftaran</li>
                <li>üì± Follow @mudumulaidulu di Instagram</li>
                <li>üóëÔ∏è Mulai kumpulkan sisa makanan selama 3 hari</li>
                <li>üì∏ Siap-siap upload hasil di 11-12 Juli</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden mt-6">
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="fas fa-exclamation-circle text-red-400"></i>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-red-800">Terjadi Kesalahan</h3>
                <div class="mt-2 text-sm text-red-700">
                  <p id="errorText">Gagal mengirim data. Silakan coba lagi nanti.</p>
                </div>
                <div class="mt-4">
                  <button onclick="hideError()" class="bg-red-100 px-3 py-1 text-sm text-red-800 rounded hover:bg-red-200">Tutup</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Enhanced Footer -->
  <footer class="bg-dark-green text-gray-300 border-t-4 border-primary-orange py-16 relative overflow-hidden">
    <div class="container mx-auto px-4 relative z-10">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Contact Information -->
        <div class="lg:col-span-2">
          <h6 class="text-gray-300 font-black text-lg uppercase tracking-wider mb-6">Contact Us</h6>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-4">
              <a href="tel:+6281224017980" class="flex items-center text-[#E98728] hover:text-orange-400 transition-colors group">
                <i class="fas fa-phone w-5 mr-3"></i>
                +62 812-2401-7980
              </a>
              <a href="mailto:mudumulaidulu@gmail.com" class="flex items-center text-[#E98728] hover:text-orange-400 transition-colors group">
                <i class="fas fa-envelope w-5 mr-3"></i>
                mudumulaidulu@gmail.com
              </a>
            </div>
            <div>
              <div class="flex items-start text-[#E98728]">
                <i class="fas fa-map-marker-alt w-5 mr-3 mt-1"></i>
                <span>Jl. Gempol 1 No.40B, RT.6/RW.2, Ceger, Kec. Cipayung, Kota Jakarta Timur, Daerah Khusus Ibukota Jakarta 13820</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Social Media -->
        <div>
          <h6 class="text-gray-300 font-black text-lg uppercase tracking-wider mb-6">Follow Us</h6>
          <div class="space-y-3">
            <a href="#" class="flex items-center text-[#E98728] hover:text-orange-400 transition-all duration-300 hover:scale-105 group">
              <i class="fab fa-facebook w-5 mr-3"></i>Facebook
            </a>
            <a href="#" class="flex items-center text-[#E98728] hover:text-orange-400 transition-all duration-300 hover:scale-105 group">
              <i class="fab fa-twitter w-5 mr-3"></i>Twitter
            </a>
            <a href="https://instagram.com/mudumulaidulu" class="flex items-center text-[#E98728] hover:text-orange-400 transition-all duration-300 hover:scale-105 group">
              <i class="fab fa-instagram w-5 mr-3"></i>Instagram
            </a>
            <a href="#" class="flex items-center text-[#E98728] hover:text-orange-400 transition-all duration-300 hover:scale-105 group">
              <i class="fab fa-linkedin w-5 mr-3"></i>LinkedIn
            </a>
          </div>
        </div>
      </div>
      
      <!-- Copyright -->
      <div class="text-center mt-12 pt-8 border-t border-gray-600">
        <p class="text-sm font-black uppercase tracking-wider">
          ¬© 2025 MuDu ‚Äî Leading The Future Of Sustainable Food Waste Management
        </p>
      </div>
    </div>
  </footer>

  <script>
    // ========== ‚úÖ APPS SCRIPT URL - SUDAH DIKONFIGURASI! ==========
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyp_1HJknKfJGFxf-lB5n_IyV0oHKTHWVMYWLjoSFRK0RPXsQK5A6A3gUKFndwnSwrgiw/exec';

    // ========== ENHANCED LOADING SYSTEM ==========
    const loadingMessages = [
      'Memproses data pendaftaran Anda...',
      'Mengupload foto ke Google Drive...',
      'Menyimpan data ke database...',
      'Mengirim email konfirmasi...',
      'Menyelesaikan pendaftaran...'
    ];

    const loadingSteps = [
      { id: 'step1', text: 'Validasi data pendaftaran...', icon: 'fas fa-circle-notch fa-spin' },
      { id: 'step2', text: 'Upload foto ke Google Drive...', icon: 'fas fa-cloud-upload-alt' },
      { id: 'step3', text: 'Simpan data ke database...', icon: 'fas fa-database' },
      { id: 'step4', text: 'Kirim email konfirmasi...', icon: 'fas fa-envelope' }
    ];

    function showLoadingOverlay() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.remove('hidden');
      
      let currentStep = 0;
      let messageIndex = 0;
      
      // Update loading messages
      const messageInterval = setInterval(() => {
        if (messageIndex < loadingMessages.length) {
          document.getElementById('loadingText').textContent = loadingMessages[messageIndex];
          messageIndex++;
        }
      }, 800);

      // Update steps
      const stepInterval = setInterval(() => {
        if (currentStep < loadingSteps.length) {
          // Complete previous step
          if (currentStep > 0) {
            const prevStep = document.getElementById(loadingSteps[currentStep - 1].id);
            prevStep.innerHTML = `<i class="fas fa-check-circle text-green-400 mr-2"></i>${loadingSteps[currentStep - 1].text.replace('...', ' ‚úÖ')}`;
            prevStep.classList.remove('opacity-50');
          }
          
          // Start current step
          if (currentStep < loadingSteps.length) {
            const currentStepEl = document.getElementById(loadingSteps[currentStep].id);
            currentStepEl.innerHTML = `<i class="${loadingSteps[currentStep].icon} mr-2"></i>${loadingSteps[currentStep].text}`;
            currentStepEl.classList.remove('opacity-50');
          }
          
          currentStep++;
        }
      }, 1000);

      // Store intervals for cleanup
      overlay.messageInterval = messageInterval;
      overlay.stepInterval = stepInterval;
    }

    function hideLoadingOverlay() {
      const overlay = document.getElementById('loadingOverlay');
      
      // Clear intervals
      if (overlay.messageInterval) clearInterval(overlay.messageInterval);
      if (overlay.stepInterval) clearInterval(overlay.stepInterval);
      
      // Complete all steps
      loadingSteps.forEach(step => {
        const stepEl = document.getElementById(step.id);
        stepEl.innerHTML = `<i class="fas fa-check-circle text-green-400 mr-2"></i>${step.text.replace('...', ' ‚úÖ')}`;
        stepEl.classList.remove('opacity-50');
      });

      // Hide after a short delay to show completion
      setTimeout(() => {
        overlay.classList.add('hidden');
      }, 500);
    }

    // ========== CITY-DISTRICT MAPPING ==========
    const cityDistrictMap = {
      "Jakarta Pusat": ["Cempaka Putih","Gambir","Johar Baru","Kemayoran","Menteng","Sawah Besar","Senen","Tanah Abang"],
      "Jakarta Utara": ["Cilincing","Kelapa Gading","Koja","Pademangan","Penjaringan","Tanjung Priok"],
      "Jakarta Barat": ["Cengkareng","Grogol Petamburan","Kalideres","Kebon Jeruk","Kembangan","Palmerah","Taman Sari","Tambora"],
      "Jakarta Selatan": ["Cilandak","Jagakarsa","Kebayoran Baru","Kebayoran Lama","Mampang Prapatan","Pancoran","Pasar Minggu","Pesanggrahan","Setiabudi","Tebet"],
      "Jakarta Timur": ["Cakung","Cipayung","Ciracas","Duren Sawit","Jatinegara","Kramat Jati","Makasar","Matraman","Pasar Rebo","Pulo Gadung"],
      "Kepulauan Seribu": ["Kepulauan Seribu Utara","Kepulauan Seribu Selatan"]
    };

    const districtSubdistrictMap = {
      // Jakarta Pusat
      "Cempaka Putih": ["Cempaka Putih Barat", "Cempaka Putih Timur", "Rawasari"],
      "Gambir": ["Cideng", "Duri Pulo", "Gambir", "Kebon Kelapa", "Petojo Selatan", "Petojo Utara"],
      "Johar Baru": ["Galur", "Johar Baru", "Kampung Rawa", "Tanah Tinggi"],
      "Kemayoran": ["Gunung Sahari Selatan", "Harapan Mulya", "Kebon Kosong", "Kemayoran", "Serdang", "Sumur Batu", "Utan Panjang"],
      "Menteng": ["Cikini", "Gondangdia", "Kebon Sirih", "Menteng", "Pegangsaan"],
      "Sawah Besar": ["Gunung Sahari Utara", "Karang Anyar", "Kartini", "Mangga Dua Selatan", "Pasar Baru"],
      "Senen": ["Bungur", "Kramat", "Kenari", "Kwitang", "Paseban", "Senen"],
      "Tanah Abang": ["Bendungan Hilir", "Gelora", "Kampung Bali", "Karet Tengsin", "Kebon Kacang", "Kebon Melati", "Petamburan", "Tanah Abang"],

      // Jakarta Utara
      "Cilincing": ["Cilincing", "Kalibaru", "Marunda", "Rorotan", "Semper Barat", "Semper Timur"],
      "Kelapa Gading": ["Kelapa Gading Barat", "Kelapa Gading Timur", "Pegangsaan Dua"],
      "Koja": ["Koja", "Lagoa", "Rawa Badak Selatan", "Rawa Badak Utara", "Tugu Selatan", "Tugu Utara"],
      "Pademangan": ["Ancol", "Pademangan Barat", "Pademangan Timur"],
      "Penjaringan": ["Kamal Muara", "Kapuk Muara", "Pejagalan", "Penjaringan", "Pluit"],
      "Tanjung Priok": ["Kebon Bawang", "Papanggo", "Sungai Bambu", "Sunter Agung", "Sunter Jaya", "Tanjung Priok", "Warakas"],

      // Jakarta Barat
      "Cengkareng": ["Cengkareng Barat", "Cengkareng Timur", "Duri Kosambi", "Kapuk", "Kedaung Kali Angke", "Rawa Buaya"],
      "Grogol Petamburan": ["Grogol", "Jelambar", "Jelambar Baru", "Tanjung Duren Selatan", "Tanjung Duren Utara", "Tomang"],
      "Kalideres": ["Kalideres", "Kamal", "Pegadungan", "Semanan", "Tegal Alur"],
      "Kebon Jeruk": ["Duri Kepa", "Kebon Jeruk", "Kelapa Dua", "Kedoya Selatan", "Kedoya Utara", "Sukabumi Selatan", "Sukabumi Utara"],
      "Kembangan": ["Joglo", "Kembangan Selatan", "Kembangan Utara", "Meruya Selatan", "Meruya Utara"],
      "Palmerah": ["Gelora", "Jatipulo", "Kemanggisan", "Kota Bambu Selatan", "Kota Bambu Utara", "Slipi"],
      "Taman Sari": ["Glodok", "Keagungan", "Krukut", "Maphar", "Mangga Besar", "Pinangsia", "Tamansari", "Tangki"],
      "Tambora": ["Angke", "Duri Selatan", "Duri Utara", "Jembatan Besi", "Jembatan Lima", "Kali Anyar", "Krendang", "Pekojan", "Roa Malaka", "Tanah Sereal"],

      // Jakarta Selatan
      "Cilandak": ["Cilandak Barat", "Cipete Selatan", "Gandaria Selatan", "Lebak Bulus", "Pondok Labu"],
      "Jagakarsa": ["Ciganjur", "Cipedak", "Jagakarsa", "Lenteng Agung", "Srengseng Sawah", "Tanjung Barat"],
      "Kebayoran Baru": ["Cipete Utara", "Gandaria Utara", "Gunung", "Kramat Pela", "Melawai", "Petogogan", "Pulo", "Rawa Barat", "Selong", "Senayan"],
      "Kebayoran Lama": ["Cipulir", "Grogol Selatan", "Grogol Utara", "Kebayoran Lama Selatan", "Kebayoran Lama Utara", "Pondok Pinang"],
      "Mampang Prapatan": ["Bangka", "Kuningan Barat", "Mampang Prapatan", "Pela Mampang", "Tegal Parang"],
      "Pancoran": ["Cikoko", "Duren Tiga", "Kalibata", "Pancoran", "Rawa Jati"],
      "Pasar Minggu": ["Cilandak Timur", "Jati Padang", "Kebagusan", "Pasar Minggu", "Pejaten Barat", "Pejaten Timur", "Ragunan"],
      "Pesanggrahan": ["Bintaro", "Petukangan Selatan", "Petukangan Utara", "Pesanggrahan", "Ulujami"],
      "Setiabudi": ["Guntur", "Karet", "Karet Kuningan", "Karet Semanggi", "Menteng Atas", "Pasar Manggis", "Setiabudi"],
      "Tebet": ["Bukit Duri", "Kebon Baru", "Manggarai", "Manggarai Selatan", "Tebet Barat", "Tebet Timur"],

      // Jakarta Timur
      "Cakung": ["Cakung Barat", "Cakung Timur", "Jatinegara", "Penggilingan", "Pulo Gebang", "Rawa Terate", "Ujung Menteng"],
      "Cipayung": ["Bambu Apus", "Ceger", "Cilangkap", "Cipayung", "Lubang Buaya", "Munjul", "Pondok Ranggon", "Setu"],
      "Ciracas": ["Cibubur", "Ciracas", "Kelapa Dua Wetan", "Susukan"],
      "Duren Sawit": ["Duren Sawit", "Klender", "Malaka Jaya", "Malaka Sari", "Pondok Bambu", "Pondok Kelapa"],
      "Jatinegara": ["Bali Mester", "Bidaracina", "Cipinang Besar Selatan", "Cipinang Besar Utara", "Cipinang Cempedak", "Cipinang Muara", "Kayu Manis", "Pisangan Baru", "Rawa Bunga"],
      "Kramat Jati": ["Batu Ampar", "Cawang", "Cililitan", "Dukuh", "Kampung Tengah", "Kramat Jati"],
      "Makasar": ["Cipinang Melayu", "Halim Perdana Kusuma", "Kebon Pala", "Makasar"],
      "Matraman": ["Kayu Manis", "Pal Meriam", "Pisangan Baru", "Utan Kayu Selatan", "Utan Kayu Utara"],
      "Pasar Rebo": ["Baru", "Cijantung", "Gedong", "Kalisari", "Pekayon"],
      "Pulo Gadung": ["Jati", "Kayu Putih", "Pisangan Timur", "Pulogadung", "Rawamangun", "Utan Kayu Selatan"],

      // Kepulauan Seribu
      "Kepulauan Seribu Utara": ["Pulau Harapan", "Pulau Kelapa", "Pulau Panggang"],
      "Kepulauan Seribu Selatan": ["Pulau Pari", "Pulau Tidung", "Pulau Untung Jawa"]
    };

    // ========== DOM ELEMENTS ==========
    const citySelect = document.getElementById('city');
    const districtSelect = document.getElementById('district');
    const subdistrictSelect = document.getElementById('subdistrict');

    // ========== LOCATION FILTERING ==========
    citySelect.addEventListener('change', () => {
      const selectedCity = citySelect.value;
      const districts = cityDistrictMap[selectedCity] || [];

      districtSelect.innerHTML = '<option value="">-- Pilih Kecamatan --</option>';
      subdistrictSelect.innerHTML = '<option value="">-- Pilih Kelurahan --</option>';

      districts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        districtSelect.appendChild(opt);
      });
    });

    districtSelect.addEventListener('change', () => {
      const selectedDistrict = districtSelect.value;
      const subdistricts = districtSubdistrictMap[selectedDistrict] || [];

      subdistrictSelect.innerHTML = '<option value="">-- Pilih Kelurahan --</option>';

      subdistricts.forEach(kel => {
        const opt = document.createElement('option');
        opt.value = kel;
        opt.textContent = kel;
        subdistrictSelect.appendChild(opt);
      });
    });

    // Prevent selecting without proper selection
    districtSelect.addEventListener('mousedown', (e) => {
      if (!citySelect.value) {
        e.preventDefault();
        showError("Silakan pilih Kota terlebih dahulu.");
        citySelect.focus();
      }
    });

    subdistrictSelect.addEventListener('mousedown', (e) => {
      if (!districtSelect.value) {
        e.preventDefault();
        showError("Silakan pilih Kecamatan terlebih dahulu.");
        districtSelect.focus();
      }
    });

    // ========== FORM NAVIGATION ==========
    function nextStep(step) {
      const currentStep = document.querySelector('.form-step:not(.hidden)');
      const inputs = currentStep.querySelectorAll('input[required], select[required]');
      let isValid = true;

      // Validate all required fields
      for (let input of inputs) {
        if (input.type === 'checkbox') {
          if (!input.checked) {
            showError(`${input.labels[0].textContent} harus dicentang.`);
            input.focus();
            isValid = false;
            break;
          }
        } else if (!input.value.trim()) {
          showError(`${input.labels[0].textContent} wajib diisi.`);
          input.focus();
          isValid = false;
          break;
        }
      }

      // Additional validations for step 1
      if (step === 2 && isValid) {
        const email = document.getElementById('email').value;
        const age = parseInt(document.getElementById('age').value);

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showError('Format email tidak valid.');
          document.getElementById('email').focus();
          isValid = false;
        }

        // Age validation
        if (age < 15 || age > 100) {
          showError('Umur harus antara 15-100 tahun.');
          document.getElementById('age').focus();
          isValid = false;
        }
      }

      // Additional validation for step 3 (photo)
      if (step === 'submit' && isValid) {
        const photoInput = document.getElementById('photo');
        if (photoInput.files.length === 0) {
          showError('Foto kantong plastik kosong wajib diupload.');
          photoInput.focus();
          isValid = false;
        } else {
          const file = photoInput.files[0];
          const maxSize = 5 * 1024 * 1024; // 5MB
          const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
          
          if (file.size > maxSize) {
            showError('Ukuran foto terlalu besar. Maksimal 5MB.');
            photoInput.focus();
            isValid = false;
          } else if (!allowedTypes.includes(file.type)) {
            showError('Format foto tidak didukung. Gunakan JPEG, PNG, atau GIF.');
            photoInput.focus();
            isValid = false;
          }
        }
      }

      // If all valid, proceed to next step
      if (isValid) {
        hideError();
        document.querySelectorAll('.form-step').forEach(el => el.classList.add('hidden'));
        if (step !== 'submit') {
          document.getElementById(`step-${step}`).classList.remove('hidden');
        }
      }

      return isValid;
    }

    function prevStep(step) {
      hideError();
      document.querySelectorAll('.form-step').forEach(el => el.classList.add('hidden'));
      document.getElementById(`step-${step}`).classList.remove('hidden');
    }

    // ========== ENHANCED FORM SUBMISSION ==========
    async function submitForm() {
      if (!nextStep('submit')) {
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      const submitText = document.getElementById('submitText');
      const submitSpinner = document.getElementById('submitSpinner');

      // Disable button and show local loading
      submitBtn.disabled = true;
      submitText.textContent = 'Mengirim...';
      submitSpinner.classList.remove('hidden');

      // Show enhanced loading overlay
      showLoadingOverlay();

      try {
        const formData = new FormData();

        // Add all form fields
        formData.append('name', document.getElementById('name').value.trim());
        formData.append('city', document.getElementById('city').value);
        formData.append('district', document.getElementById('district').value);
        formData.append('subdistrict', document.getElementById('subdistrict').value);
        formData.append('age', document.getElementById('age').value);
        formData.append('email', document.getElementById('email').value.trim().toLowerCase());

        // Checkbox values
        formData.append('mechanism_agree', document.getElementById('mechanism_agree').checked.toString());
        formData.append('photo_agree', document.getElementById('photo_agree').checked.toString());
        formData.append('policy_agree', document.getElementById('policy_agree').checked.toString());

        // Handle photo upload with Base64 encoding
        const photoInput = document.getElementById('photo');
        const photoFile = photoInput.files[0];

        if (photoFile) {
          // Validate file size
          const maxSize = 5 * 1024 * 1024; // 5MB
          if (photoFile.size > maxSize) {
            throw new Error('Ukuran foto terlalu besar. Maksimal 5MB.');
          }

          // Convert to Base64
          const reader = new FileReader();
          const base64Data = await new Promise((resolve, reject) => {
            reader.onload = function(event) {
              resolve(event.target.result.split(',')[1]); // Get Base64 part only
            };
            reader.onerror = function(error) {
              reject(error);
            };
            reader.readAsDataURL(photoFile);
          });

          formData.append("media_base64", base64Data);
          formData.append("media_filename", photoFile.name);
          formData.append("media_mimetype", photoFile.type);
          console.log('üì∏ Photo converted to Base64. Size:', base64Data.length);

        } else {
          formData.append("media_base64", "");
          formData.append("media_filename", "");
          formData.append("media_mimetype", "");
        }

        console.log('üöÄ Submitting to Apps Script:', APPS_SCRIPT_URL);

        // Submit to Google Apps Script
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData,
          mode: 'cors'
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        console.log('‚úÖ Response:', result);

        // Hide loading overlay
        hideLoadingOverlay();

        if (result.result === 'success') {
          // Hide form and show success message
          document.getElementById('pilotForm').classList.add('hidden');
          document.getElementById('successMessage').classList.remove('hidden');

          // Show email status
          if (result.emailSent === true) {
            document.getElementById('emailSent').classList.remove('hidden');
          } else {
            document.getElementById('emailFailed').classList.remove('hidden');
          }

          // Scroll to success message
          document.getElementById('successMessage').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });

          // Optional: Confetti effect or celebration animation
          setTimeout(() => {
            console.log('üéâ Registration completed successfully!');
          }, 500);

        } else {
          throw new Error(result.error || 'Gagal mengirim data');
        }

      } catch (error) {
        console.error('‚ùå Submission error:', error);

        // Hide loading overlay
        hideLoadingOverlay();

        let errorMessage = 'Gagal mengirim pendaftaran. ';

        if (error.message.includes('Failed to fetch')) {
          errorMessage += 'Periksa koneksi internet dan coba lagi.';
        } else if (error.message.includes('405')) {
          errorMessage += 'URL Google Apps Script tidak benar. Pastikan sudah deploy sebagai Web App.';
        } else if (error.message.includes('CORS')) {
          errorMessage += 'Masalah konfigurasi. Hubungi administrator.';
        } else {
          errorMessage += error.message;
        }

        showError(errorMessage);

        // Reset button state
        submitBtn.disabled = false;
        submitText.textContent = 'Kirim Pendaftaran';
        submitSpinner.classList.add('hidden');
      }
    }

    // ========== ERROR HANDLING ==========
    function showError(message) {
      const errorElement = document.getElementById('errorMessage');
      const errorText = document.getElementById('errorText');
      
      errorText.textContent = message;
      errorElement.classList.remove('hidden');
      
      // Scroll to error
      errorElement.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
      });

      // Auto hide after 8 seconds
      setTimeout(hideError, 8000);
    }

    function hideError() {
      document.getElementById('errorMessage').classList.add('hidden');
    }

    // ========== MOBILE MENU ==========
    document.getElementById('menu-toggle').addEventListener('click', function () {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
    });

    // ========== NAVBAR SCROLL EFFECT ==========
    window.addEventListener('scroll', function() {
      const navbar = document.querySelector('nav');
      if (window.scrollY > 50) {
        navbar.classList.add('bg-white/98', 'shadow-lg');
        navbar.classList.remove('bg-white/95');
      } else {
        navbar.classList.remove('bg-white/98', 'shadow-lg');
        navbar.classList.add('bg-white/95');
      }
    });

    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      // Hide loading spinner initially
      document.getElementById('submitSpinner').classList.add('hidden');
      
      // Focus on first input
      document.getElementById('name').focus();

      console.log('üå± MuDu Challenge form initialized');
      console.log('üîó Apps Script URL:', APPS_SCRIPT_URL);
      console.log('üìß Email notifications enabled');
      console.log('‚úÖ Enhanced loading system ready!');
    });

    // ========== REAL-TIME VALIDATION ==========
    
    // Email validation
    document.getElementById('email').addEventListener('blur', function() {
      const email = this.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email && !emailRegex.test(email)) {
        this.style.borderColor = '#ef4444';
      } else {
        this.style.borderColor = '#d1d5db';
      }
    });

    // Age validation
    document.getElementById('age').addEventListener('blur', function() {
      const age = parseInt(this.value);
      
      if (this.value && (age < 15 || age > 100)) {
        this.style.borderColor = '#ef4444';
      } else {
        this.style.borderColor = '#d1d5db';
      }
    });

    // Photo validation
    document.getElementById('photo').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        const maxSize = 5 * 1024 * 1024; // 5MB
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
        
        if (file.size > maxSize) {
          this.style.borderColor = '#ef4444';
          this.value = '';
          showError('Ukuran foto terlalu besar. Maksimal 5MB.');
        } else if (!allowedTypes.includes(file.type)) {
          this.style.borderColor = '#ef4444';
          this.value = '';
          showError('Format foto tidak didukung. Gunakan JPEG, PNG, atau GIF.');
        } else {
          this.style.borderColor = '#22c55e';
          hideError();
          console.log('üì∏ Photo selected:', file.name, (file.size / 1024 / 1024).toFixed(2) + 'MB');
        }
      }
    });

    // ========== ENHANCED USER EXPERIENCE ==========

    // Add typing effect for success message
    function typeWriterEffect(element, text, speed = 50) {
      let i = 0;
      element.innerHTML = '';
      
      function typeWriter() {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(typeWriter, speed);
        }
      }
      
      typeWriter();
    }

    // Add celebration effect when form is submitted successfully
    function celebrateSuccess() {
      // Create floating success icons
      for (let i = 0; i < 10; i++) {
        setTimeout(() => {
          const icon = document.createElement('div');
          icon.innerHTML = 'üéâ';
          icon.style.position = 'fixed';
          icon.style.left = Math.random() * window.innerWidth + 'px';
          icon.style.top = '-50px';
          icon.style.fontSize = '2rem';
          icon.style.zIndex = '10000';
          icon.style.pointerEvents = 'none';
          icon.style.animation = 'fall 3s linear forwards';
          
          document.body.appendChild(icon);
          
          setTimeout(() => {
            document.body.removeChild(icon);
          }, 3000);
        }, i * 200);
      }
    }

    // Add smooth transitions between steps
    function smoothStepTransition(fromStep, toStep) {
      const from = document.getElementById(`step-${fromStep}`);
      const to = document.getElementById(`step-${toStep}`);
      
      from.style.opacity = '0';
      from.style.transform = 'translateX(-20px)';
      
      setTimeout(() => {
        from.classList.add('hidden');
        to.classList.remove('hidden');
        to.style.opacity = '0';
        to.style.transform = 'translateX(20px)';
        
        setTimeout(() => {
          to.style.opacity = '1';
          to.style.transform = 'translateX(0)';
        }, 50);
      }, 200);
    }

  </script>
</body>
</html>